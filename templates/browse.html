{% extends "base.html" %}
{% block title %}Browse Recipes | {% endblock %}
{% block content %}

<!--Page Title-->
<div class="row center-align">
    <div class="col s12">
        <h1 class="page-title">Recipes</h1>
    </div>
</div>

<!--Search And Filters Form-->
<div class="row center-align">

    <form id="search_form">
        <ul class="collapsible search-option center-align">
            <li>
                <div class="collapsible-header search-header">
                    <h3 class="search-form-title">
                        <i class="fas fa-search" aria-hidden="true"></i>
                        Search
                    </h3>
                </div>
                <div class="collapsible-body search-body collection collapsible-collection search-body">
                    <!--Helper Text/Instructions-->
                    <div class="col s12">
                        <h6 class="helper">Search by recipe name.</h6>
                    </div>
                    <!--Search Field-->
                    <div class="input-field col s12 search-form-wrapper">
                        <i class="fas fa-search prefix" aria-hidden="true"></i>
                        <input id="search" name="search" type="text" placeholder="Search Recipe Name..." class="form-control validate" required>
                        <label for="search">Search Recipe Name</label>
                    </div>
                    <!--Submit Button-->
                    <div class="row submit-button-wrapper">
                        <div class="col s6">
                            <button id="search_btn" class="btn waves-effect waves-light sm-md-btn" type="submit">
                                <span class="hide-on-small-and-down">Search</span>
                                <i class="fas fa-search" aria-hidden="true"></i>
                            </button>
                        </div>
                        <!--Reset Button-->
                        <div class="col s6">
                            <a class="btn waves-effect waves-light sm-md-btn" href="{{ url_for('get_recipes', page=1) }}">
                                <span class="hide-on-small-and-down">Reset</span>
                                <i class="fas fa-undo-alt" aria-hidden="true"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </form>
    
    <form id="filter_form" method="POST" action="{{ url_for('get_recipes', page=1) }}">
        <ul class="collapsible filter-option">
            <li>
                <div class="collapsible-header filter-header">
                    <h3 class="filter-form-title">
                        <i class="fas fa-filter" aria-hidden="true"></i>
                        Filter
                    </h3>
                </div>
                <div class="collapsible-body filter-body collection collapsible-collection filter-body">
                    <!--Helper Text/Instructions-->
                    <div class="col s12">
                        <h6 class="helper">Filter by one or multiple categories, then you may choose how to sort the results.</h6>
                    </div>
                    <div class="row filter-form-wrapper">
                        <!--Type Category Drop Down-->
                        <div class="input-field col s12 m3">
                            <select id="type" name="type" class="form-control validate">
                                <option value="" disabled selected>Type</option>
                                <!--Loop through time_list and inject data into the drop down menu-->
                                {% for type in types %}
                                <option value"{{ type }}">{{ type|capitalize }}</option>
                                {% endfor %}
                            </select>
                            <label for="type">Recipe Type</label>
                        </div>
                        <!--Occasion Category Drop Down-->
                        <div class="input-field col s12 m3">
                            <select id="occasion" name="occasion" class="form-control validate">
                                <option value="" disabled selected>Occasion</option>
                                {% for occasion in occasions %}
                                <option value"{{ occasion }}">{{ occasion|capitalize }}</option>
                                {% endfor %}
                            </select>
                            <label for="occasion">Occasion</label>
                        </div>
                        <!--Cuisine Category Drop Down-->
                        <div class="input-field col s12 m3">
                            <select id="cuisine" name="cuisine" class="form-control validate">
                                <option value="" disabled selected>Cuisine</option>
                                {% for cuisine in cuisines %}
                                <option value"{{ cuisine }}">{{ cuisine|capitalize }}</option>
                                {% endfor %}
                            </select>
                            <label for="cuisine">Cuisine</label>
                        </div>
                        <!--Main Ingredient Category Drop Down-->
                        <div class="input-field col s12 m3">
                            <select id="main_ing" name="main_ing" class="form-control validate">
                                <option value="" disabled selected>Main Ingredient</option>
                                {% for ing in main_ing %}
                                <option value"{{ ing }}">{{ ing|capitalize }}</option>
                                {% endfor %}
                            </select>
                            <label for="main_ing">Main Ingredient</label>
                        </div>
                        <!--Submit Button-->
                        <div class="row submit-button-wrapper">
                            <div class="col s6">
                                <button id="search_btn" class="btn waves-effect waves-light sm-md-btn" type="submit">
                                    <span class="hide-on-small-and-down">Search</span>
                                    <i class="fas fa-search" aria-hidden="true"></i>
                                </button>
                            </div>
                            <!--Reset Button-->
                            <div class="col s6">
                                <a class="btn waves-effect waves-light sm-md-btn" href="{{ url_for('get_recipes', page=1) }}">
                                    <span class="hide-on-small-and-down">Reset</span>
                                    <i class="fas fa-undo-alt" aria-hidden="true"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </form>
    
    <!--Recipe Details Card-->
    <div class="row recipe-card card z-depth-1">
        <div class="col s12 center-align recipe-count-wrapper">
            {% if search_results %}
                {% if search_results_count == 0 %}
                    <h6 class="recipe-details-text">
                        <span class="recipe-count bold italic">No</span>
                         recipes found.
                    </h6>
                {% elif search_results_count == 1 %}
                    <h6 class="recipe-details-text">
                        <span class="recipe-count bold italic">{{ search_results_count }}</span>
                         recipe found.
                    </h6>
                {% else %}
                    <h6 class="recipe-details-text">
                        <span class="recipe-count bold italic">{{ search_results_count }}</span>
                         recipes found, sorted by 
                         <span class="recipe-sorted bold italic">most liked</span>.
                    </h6>
                {% endif %}
            {% elif recipes %}
                {% if recipes_count == 0 %}
                    <h6 class="recipe-details-text">
                        <span class="recipe-count bold italic">No</span>
                         recipes found.
                    </h6>
                {% elif recipes_count == 1 %}
                    <h6 class="recipe-details-text">
                        <span class="recipe-count bold italic">{{ recipes_count }}</span>
                         recipe found.
                    </h6>
                {% elif recipes_count > 1 %}
                    <h6 class="recipe-details-text">
                        <span class="recipe-count bold italic">{{ recipes_count }}</span>
                         recipes found, sorted by 
                         <span class="recipe-sorted bold italic">most liked</span>.
                    </h6>
                {% endif %}
            {% else %}
                <h6 class="recipe-details-text">
                    <span class="recipe-count bold italic">No</span>
                     recipes found.</h6>
            {% endif %}
        </div>
    </div>

</div>

<!--Recipe Cards-->
<div class="row center-align">
    <!--WITHOUT SEARCH-->
    {% if search_results == "" %}
        {% for recipe in recipes %}
        <!--Only display recipe if the deleted field value is false-->
        {% if recipe.deleted == False %}
        <div class="col s12 m3 recipe-preview-card">
            <div id="{{ recipe._id }}" class="card hoverable results-card z-depth-1">
                <a href="{{ url_for('recipe', recipe_id=recipe._id) }}">
                    <!--Recipe Image-->
                    <div class="card-image">
                        <img src="{{ url_for('static', filename=recipe.img) }}" alt="{{ recipe.name }}" class="activator" lazyload="on">
                    </div>
                    <!--Recipe Name-->
                    <div class="card-title center-align">
                        {{ recipe.name | title }}
                    </div>
                </a>
                <!--Recipe Quick Stats-->
                <div class="card-content card-stats">
                    <span>
                        <i class="far fa-eye" aria-hidden="true"></i><br>
                        {{ recipe.views }}
                    </span>
                    <span>
                        <i class="fas fa-thumbs-up" aria-hidden="true"></i><br>
                        {{ recipe.likes }}
                    </span>
                    <span>
                        <i class="far fa-star" aria-hidden="true"></i><br>
                        <!--Iterate through rating array and calculate average rating-->
                        {% set rating = [] %}
                        {% for r in recipe.rating_values %}
                            {% if rating.append(r) %}
                            {% endif %}
                        {% endfor %}
                        {{ (rating | sum / rating | count) | int }}/5
                    </span>
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    <!--WITH SEARCH-->
    {% else %}
        {% for recipe in search_results %}
        <!--Only display recipe if the deleted field value is false-->
        {% if recipe.deleted == False %}
        <div class="col s12 m3 recipe-preview-card">
            <div id="{{ recipe._id }}" class="card hoverable results-card z-depth-1">
                <a href="{{ url_for('recipe', recipe_id=recipe._id) }}">
                    <!--Recipe Image-->
                    <div class="card-image">
                        <img src="{{ url_for('static', filename=recipe.img) }}" alt="{{ recipe.name }}" class="activator" lazyload="on">
                    </div>
                    <!--Recipe Name-->
                    <div class="card-title center-align">
                        {{ recipe.name | title }}
                    </div>
                </a>
                <!--Recipe Quick Stats-->
                <div class="card-content card-stats">
                    <span>
                        <i class="far fa-eye" aria-hidden="true"></i><br>
                        {{ recipe.views }}
                    </span>
                    <span>
                        <i class="fas fa-thumbs-up" aria-hidden="true"></i><br>
                        {{ recipe.likes }}
                    </span>
                    <span>
                        <i class="far fa-star" aria-hidden="true"></i><br>
                        <!--Iterate through rating array and calculate average rating-->
                        {% set rating = [] %}
                        {% for r in recipe.rating_values %}
                            {% if rating.append(r) %}
                            {% endif %}
                        {% endfor %}
                        {{ (rating | sum / rating | count) | int }}/5
                    </span>
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    {% endif %}
</div>

<!--Pagination Links-->
<div class="row center-align">
    
    <div class="col s12">
        <!--Pagination for search results-->
        {% if search_results == "" %}
            <ul class="pagination">
                <li id="previous-page" {% if page|int <= 1 %} class="disabled" {% endif %}>
                    <a {% if page|int > 1 %} href="{{ url_for('get_recipes', page=page|int-1) }}" {% endif %}>
                        <i class="fas fa-chevron-left" aria-hidden="true"></i>
                    </a>
                </li>
                <h6 class="pagination-helper bold">
                    Page 
                    <span class="pagination-count bold italic">{{ page }}</span>
                     of 
                    <span class="pagination-count bold italic">{{ total_pages }}</span>
                </h6>
                <li id="next-page" {% if page|int == total_pages|int %} class="disabled" {% endif %}>
                    <a {% if page|int != total_pages|int %} href="{{ url_for('get_recipes', page=page|int+1) }}" {% endif %}>
                        <i class="fas fa-chevron-right" aria-hidden="true"></i>
                    </a>
                </li>
            </ul>
        {% endif %}
    </div>
    
</div>

{% endblock %}
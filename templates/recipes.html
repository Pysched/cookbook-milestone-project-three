{% extends "base.html" %}
{% block content %}

<!--Page Title - Recipe Name-->
<div class="row center-align">
    <div class="col s12">
        <h1 class="title">{{ recipe.name | title }}</h1>
    </div>
</div>

<!--RECIPE CARD - IMAGE AND GENERAL DETAILS-->
<div class="row center-align">

    <!--Recipe Image, Stats and Buttons Card-->
    <div class="row card z-depth-1">
        <!--Recipe Image-->
        <div class="col s12 m6 center-align recipe-img">
            <img class="responsive-img" alt="{{ recipe.name }}"src="{{ url_for('static', filename=recipe.img) }}">
        </div>
        <!--Recipe Stats-->
        <div class="col s12 m6 center-align recipe-details">
            <p class="stat">
                Rating: 
                {% set rating = [] %}
                {% for r in recipe.rating_values %}
                    {% if rating.append(r) %}
                    {% endif %}
                {% endfor %}
                {{ (rating | sum / rating | count) | int }}/5
            </p>
            <p class="stat">
                Times Rated: {{ rating | count }}
            </p>
            <a href="#rate_modal" class="waves-effect waves-light btn modal-trigger">
                <i class="far fa-star" aria-hidden="true"></i>Rate It
            </a>
            <p class="stat">
                Prep Time: {{ recipe.prep_time }}
            </p>
            <p class="stat">
                Cook Time: {{ recipe.cook_time }}
            </p>
            <p class="stat">
                Serves: {{ recipe.serves | capitalize }}
            </p>
            <p class="stat">
                By: {{ recipe.author | title }}
            </p>
            <p class="stat">
                Added: {{ recipe.added_date }}
            </p>
        </div>
        <!--Buttons - vary depending on whether user is in session-->
        <div class="col s12 center-align options-buttons">
            <a id="print-btn" class="waves-effect waves-light btn">
                <i class="fas fa-print" aria-hidden="true"></i>
                <span class="hide-on-small-and-down">Print</span>
            </a>
            <!--Extra options when user logged in-->
            {% if session.user %}
                <a href="" class="waves-effect waves-light btn">
                    <i class="fas fa-edit" aria-hidden="true"></i>
                    <span class="hide-on-small-and-down">Edit</span>
                </a>
                    
                    {% if session.user | lower == added_by %}
                    <a href="#delete_modal" class="waves-effect waves-light btn modal-trigger">
                        <i class="fas fa-trash-alt" aria-hidden="true"></i>
                        <span class="hide-on-small-and-down">Delete</span>
                    </a>
                    {% endif %}
                <!--ONLY ON DISPLAY IF THE RECIPE ID IS IN THE USER LIKED LIST-->
                <a href="" class="waves-effect waves-light btn hide">
                    <i class="fas fa-thumbs-up" aria-hidden="true"></i>
                    <span class="hide-on-small-and-down">Liked</span>
                </a>
                
                <!--ONLY ON DISPLAY IF THE RECIPE ID IS NOT IN THE USER LIKED LIST-->
                <a href="" class="waves-effect waves-light btn">
                    <i class="far fa-thumbs-up" aria-hidden="true"></i>
                    <span class="hide-on-small-and-down">Like</span>
                </a>
            {% endif %}
        </div>
    </div>

</div>

<!--Rate It Modal-->
<div id="rate_modal" class="modal">
    <div class="modal-content center-align">
        <h5 class="bold">Choose your rating.</h5>
        <form method="GET" action="">    
            <div class="input-field col s12">
                <select id="rating" name="rating" class="form-control validate" required>
                    <option disabled selected>Rating</option>
                    {% for r in ratings %}
                    <option value="{{ r }}">{{ r }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="input-field col s12">
                <button class="btn waves-effect waves-light" type="submit" name="register">
                    <i class="far fa-star" aria-hidden="true"></i>
                    Rate It
                </button>
            </div>
        </form>
    </div>
</div>

<!--Delete Modal-->
<div id="delete_modal" class="modal">
    <div class="modal-content center-align">
        <h5 class="bold">Are you sure you want to delete this recipe?</h5>
        <a class="waves-effect waves-light btn" href="">
            <i class="fas fa-check" aria-hidden="true"></i>
            <span class="hide-on-small-and-down">Yes</span>
        </a>
        <a class="waves-effect waves-light btn" href="">
            <i class="fas fa-times" aria-hidden="true"></i>
            <span class="hide-on-small-and-down">No</span>
        </a>
    </div>
</div>

{% endblock %}